(this.webpackJsonpwebvideo=this.webpackJsonpwebvideo||[]).push([[0],{188:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n(2),r=n.n(a),i=n(76),o=n.n(i),u=(n(84),n(85),n(30)),s=n.n(u),d=n(77),l=n(7),j=n(78),f=n.n(j),b=function(e){var t=e.username,n=e.handleUsernameChange,a=e.roomName,r=e.handleRoomNameChange,i=e.handleSubmit,o=e.connecting;return Object(c.jsxs)("form",{onSubmit:i,children:[Object(c.jsx)("h2",{children:"Enter a room"}),Object(c.jsxs)("div",{children:[Object(c.jsx)("label",{htmlFor:"name",children:"Name:"}),Object(c.jsx)("input",{type:"text",id:"field",value:t,onChange:n,readOnly:o,required:!0})]}),Object(c.jsxs)("div",{children:[Object(c.jsx)("label",{htmlFor:"room",children:"Room name:"}),Object(c.jsx)("input",{type:"text",id:"room",value:a,onChange:r,readOnly:o,required:!0})]}),Object(c.jsx)("button",{type:"submit",disabled:o,children:o?"Connecting":"Join"})]})},h=n(15),O=function(e){var t=e.participant,n=Object(a.useState)([]),r=Object(l.a)(n,2),i=r[0],o=r[1],u=Object(a.useState)([]),s=Object(l.a)(u,2),d=s[0],j=s[1],f=Object(a.useRef)(),b=Object(a.useRef)(),O=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};return Object(a.useEffect)((function(){o(O(t.videoTracks)),j(O(t.audioTracks));return t.on("trackSubscribed",(function(e){"video"===e.kind?o((function(t){return[].concat(Object(h.a)(t),[e])})):"audio"===e.kind&&j((function(t){return[].concat(Object(h.a)(t),[e])}))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?o((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&j((function(t){return t.filter((function(t){return t!==e}))}))})),function(){o([]),j([]),t.removeAllListeners()}}),[t]),Object(a.useEffect)((function(){var e=i[0];if(e)return e.attach(f.current),document.getElementById("video").style.transform="scale(-1, 1)",function(){e.detach()}}),[i]),Object(a.useEffect)((function(){var e=d[0];if(e)return e.attach(b.current),function(){e.detach()}}),[d]),Object(c.jsxs)("div",{className:"participant",children:[Object(c.jsx)("h3",{children:t.identity}),Object(c.jsx)("video",{id:"video",ref:f,autoPlay:!0}),Object(c.jsx)("audio",{ref:b,autoPlay:!0})]})},m=function(e){var t=e.roomName,n=e.room,r=e.handleLogout,i=Object(a.useState)([]),o=Object(l.a)(i,2),u=o[0],s=o[1];Object(a.useEffect)((function(){var e=function(e){s((function(t){return[].concat(Object(h.a)(t),[e])}))},t=function(e){s((function(t){return t.filter((function(t){return t!==e}))}))};return n.on("participantConnected",e),n.on("participantDisconnected",t),n.participants.forEach(e),function(){n.off("participantConnected",e),n.off("participantDisconnected",t)}}),[n]);var d=u.map((function(e){return Object(c.jsx)(O,{participant:e},e.sid)}));return Object(c.jsxs)("div",{className:"room",children:[Object(c.jsxs)("h2",{children:["Room: ",t]}),Object(c.jsx)("button",{onClick:r,children:"Log out"}),Object(c.jsxs)("div",{className:"video-container",children:[Object(c.jsx)("div",{className:"local-participant",children:n?Object(c.jsx)(O,{participant:n.localParticipant},n.localParticipant.sid):""}),Object(c.jsx)("div",{className:"remote-participants",children:d})]})]})},p=function(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(""),o=Object(l.a)(i,2),u=o[0],j=o[1],h=Object(a.useState)(null),O=Object(l.a)(h,2),p=O[0],v=O[1],x=Object(a.useState)(!1),g=Object(l.a)(x,2),k=g[0],C=g[1],w=Object(a.useCallback)((function(e){r(e.target.value)}),[]),y=Object(a.useCallback)((function(e){j(e.target.value)}),[]),E=Object(a.useCallback)(function(){var e=Object(d.a)(s.a.mark((function e(t){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),C(!0),"https://pacific-hamlet-35469.herokuapp.com/token",e.next=5,fetch("".concat("https://pacific-hamlet-35469.herokuapp.com/token","?identity=").concat(n,"&roomName=").concat(u)).then((function(e){return e.text()}));case 5:c=e.sent,f.a.connect(c,{name:u}).then((function(e){C(!1),v(e)})).catch((function(e){console.error(e),C(!1)}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[u,n]),N=Object(a.useCallback)((function(){v((function(e){return e&&(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),e.disconnect()),null}))}),[]);return Object(a.useEffect)((function(){if(p){var e=function(e){e.persisted||p&&N()};return window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e),function(){window.removeEventListener("pagehide",e),window.removeEventListener("beforeunload",e)}}}),[p,N]),p?Object(c.jsx)(m,{roomName:u,room:p,handleLogout:N}):Object(c.jsx)(b,{username:n,roomName:u,handleUsernameChange:w,handleRoomNameChange:y,handleSubmit:E,connecting:k})},v=function(){return Object(c.jsxs)("div",{className:"app",children:[Object(c.jsx)("header",{children:Object(c.jsx)("h1",{children:"Twilio Video Chat"})}),Object(c.jsx)("main",{children:Object(c.jsx)(p,{})}),Object(c.jsx)("footer",{children:Object(c.jsxs)("p",{children:["Made with"," ",Object(c.jsx)("span",{role:"img","aria-label":"React",children:"\u269b\ufe0f"})," "]})})]})},x=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,189)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))};o.a.render(Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(v,{})}),document.getElementById("root")),x()},84:function(e,t,n){},85:function(e,t,n){}},[[188,1,2]]]);
//# sourceMappingURL=main.f55b3f50.chunk.js.map